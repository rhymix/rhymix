<include target="config_header.html" />
<div cond="$XE_VALIDATOR_MESSAGE && $XE_VALIDATOR_ID == 'modules/admin/tpl/config_general/1'" class="message {$XE_VALIDATOR_MESSAGE_TYPE}">
	<p>{$XE_VALIDATOR_MESSAGE}</p>
</div>
<section class="section">
	<form action="./" method="post" enctype="multipart/form-data" id="config_form" class="x_form-horizontal">
		<input type="hidden" name="module" value="admin" />
		<input type="hidden" name="act" value="procAdminUpdateConfigGeneral" />
		<input type="hidden" name="xe_validator_id" value="modules/admin/tpl/config_general/1" />
		<div></div>
	</form>
	<div class="x_form-horizontal" id="admin_config">
		<div class="x_control-group">
			<label class="x_control-label">{$lang->site_title}</label>
			<div class="x_controls">
				<input type="text" name="site_title" value="{$var_site_title}" class="lang_code" />
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->site_subtitle}</label>
			<div class="x_controls">
				<input type="text" name="site_subtitle" value="{$var_site_subtitle}" class="lang_code" />
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label" for="_target_module">{$lang->start_module}</label>
			<div class="x_controls">
				<input class="module_search" type="text" name="index_module_srl" value="{$start_module->index_module_srl}" />
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label" for="html_footer">{$lang->input_footer_script}</label>
			<div class="x_controls" style="margin-right:14px">
				<textarea name="html_footer" id="html_footer" rows="6" style="width:100%" placeholder="{$lang->detail_input_footer_script}" title="{$lang->detail_input_footer_script}">{$all_html_footer}</textarea>
			</div>
		</div>
		<div class="x_control-group">
			<label for="default_lang" class="x_control-label">{$lang->default_lang}</label>
			<div class="x_controls">
				<select name="default_lang" id="default_lang">
					<option value="{$key}" loop="$enabled_lang=>$key" selected="selected"|cond="$key==$default_lang">{$supported_lang[$key]}</option>
				</select>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->lang_select}</label>
			<div class="x_controls">
				<label for="lang_{$key}" class="x_inline" loop="$supported_lang=>$key,$val">
					<input type="checkbox" name="enabled_lang[]" id="lang_{$key}" value="{$key}" disabled="disabled"|cond="$key==$default_lang" checked="checked"|cond="in_array($key, $enabled_lang)" />
					{$val}
				</label>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->auto_select_lang}</label>
			<div class="x_controls">
				<label for="auto_select_lang_y" class="x_inline">
					<input type="radio" name="auto_select_lang" id="auto_select_lang_y" value="Y" checked="checked"|cond="$auto_select_lang" />
					{$lang->cmd_yes}
				</label>
				<label for="auto_select_lang_n" class="x_inline">
					<input type="radio" name="auto_select_lang" id="auto_select_lang_n" value="N" checked="checked"|cond="!$auto_select_lang" />
					{$lang->cmd_no}
				</label>
				<br />
				<p class="x_help-block">{$lang->about_auto_select_lang}</p>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label" for="default_timezone">{$lang->timezone}</label>
			<div class="x_controls">
				<select name="default_timezone">
					<option loop="$timezones => $key,$val" value="{$key}" selected="selected"|cond="$key==$selected_timezone">{$val}</option>
				</select>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->use_mobile_view}</label>
			<div class="x_controls">
				<label for="use_mobile_view_y" class="x_inline">
					<input type="radio" name="use_mobile_view" id="use_mobile_view_y" value="Y" checked="checked"|cond="$use_mobile_view" />
					{$lang->cmd_yes}
				</label>
				<label for="use_mobile_view_n" class="x_inline">
					<input type="radio" name="use_mobile_view" id="use_mobile_view_n" value="N" checked="checked"|cond="!$use_mobile_view" />
					{$lang->cmd_no}
				</label>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->tablets_as_mobile}</label>
			<div class="x_controls">
				<label for="tablets_as_mobile_y" class="x_inline">
					<input type="radio" name="tablets_as_mobile" id="tablets_as_mobile_y" value="Y" checked="checked"|cond="$tablets_as_mobile" />
					{$lang->cmd_yes}
				</label>
				<label for="tablets_as_mobile_n" class="x_inline">
					<input type="radio" name="tablets_as_mobile" id="tablets_as_mobile_n" value="N" checked="checked"|cond="!$tablets_as_mobile" />
					{$lang->cmd_no}
				</label>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->allow_use_favicon}</label>
			<div class="x_controls">
				<p id="faviconPreview">
					<img src="{$favicon_url}" alt="Favicon" class="fn1" style="width:16px;height:16px">
					<img src="{$favicon_url}" alt="Favicon" class="fn2" style="width:16px;height:16px">
				</p>
				<label><input type="checkbox" name="is_delete_favicon" value="1" /> {$lang->cmd_delete}</label>
				<form action="./" enctype="multipart/form-data" method="post" target="hiddenIframe" class="imageUpload" style="margin:0">
					<input type="hidden" name="module" value="admin">
					<input type="hidden" name="act" value="procAdminFaviconUpload">
					<p>
						<input type="file" name="favicon" id="favicon" title="Favicon"/>
						<input class="x_btn" type="submit" value="{$lang->cmd_upload}" style="vertical-align:top">
					</p>
				</form>
				<span class="x_help-block">{$lang->about_use_favicon}</span>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->allow_use_mobile_icon}</label>
			<div class="x_controls">
				<p id="mobiconPreview">
					<img src="{$mobicon_url}" alt="Mobile Home Icon" width="32" height="32" />
					<span>Rhymix</span>
				</p>
				<label><input type="checkbox" name="is_delete_mobicon" value="1" /> {$lang->cmd_delete}</label>
				<form action="./" enctype="multipart/form-data" method="post" target="hiddenIframe" class="imageUpload" style="margin:0">
					<input type="hidden" name="module" value="admin">
					<input type="hidden" name="act" value="procAdminFaviconUpload">
					<p>
						<input type="file" name="mobicon" id="mobicon" title="Mobile Home Icon"/>
						<input class="x_btn" type="submit" value="{$lang->cmd_upload}" style="vertical-align:top">
					</p>
				</form>
				<span class="x_help-block">{$lang->detail_use_mobile_icon}</span>
			</div>
		</div>
		<div class="x_control-group">
			<label class="x_control-label">{$lang->cmd_site_default_image}</label>
			<div class="x_controls">
				<p id="default_imagePreview">
					<img src="{$site_default_image_url}" alt="Default Image" style="width:200px;height:auto" />
				</p>
				<label><input type="checkbox" name="is_delete_default_image" value="1" /> {$lang->cmd_delete}</label>
				<form action="./" enctype="multipart/form-data" method="post" target="hiddenIframe" class="imageUpload" style="margin:0">
					<input type="hidden" name="module" value="admin">
					<input type="hidden" name="act" value="procAdminFaviconUpload">
					<p>
						<input type="file" name="default_image" id="default_image" title="Site default image"/>
						<input class="x_btn" type="submit" value="{$lang->cmd_upload}" style="vertical-align:top">
					</p>
				</form>
				<span class="x_help-block">{$lang->about_site_default_image}</span>
			</div>
		</div>
		<div class="x_clearfix btnArea">
			<div class="x_pull-right">
				<button type="submit" class="x_btn x_btn-primary" onclick="doSubmitConfig()">{$lang->cmd_save}</button>
			</div>
		</div>
	</div>
</section>

<iframe name="hiddenIframe" src="about:blank" hidden></iframe>
<script>
jQuery(function() {
	if (jQuery("#default_imagePreview img").attr("src") == "") {
		jQuery("#default_imagePreview").hide();
		jQuery("input[name='is_delete_default_image']").parent().hide();
	}
});

function afterUploadConfigImage(name, tmpFileName) {
	jQuery('#' + name + 'Preview img').attr('src', tmpFileName).parent().show();
	jQuery('#' + name).val('');
	jQuery("input[name='is_delete_" + name + "']").prop('checked', false).parent().show();
}

function alertUploadMessage(msg) {
	alert(msg);
}

function doSubmitConfig()
{
	var $forms = jQuery('#admin_config').find('input[name][type="hidden"], input[name][type="text"], input[name][type="checkbox"]:checked, select[name], textarea[name], input[name][type="radio"]:checked');
	var $configForm = jQuery('#config_form');
	var $container = $configForm.children('div');
	$container.empty();

	$forms.each(function($)
	{
		var $this = jQuery(this);

		if($this.parents('.imageUpload').length) return;

		var $input = jQuery('<input>').attr('type', 'hidden').attr('name', $this.attr('name')).val($this.val());
		$container.append($input);
	});
	$configForm.submit();
}

</script>

